---
title: Procedimientos recomendados de OpenXR
description: Conozca los procedimientos recomendados para la calidad, la estabilidad y el rendimiento visual de las aplicaciones de OpenXR.
author: thetuvix
ms.author: alexturn
ms.date: 2/28/2020
ms.topic: article
keywords: OpenXR, Khronos, BasicXRApp, DirectX, Native, aplicación nativa, motor personalizado, middleware, procedimientos recomendados, rendimiento, calidad, estabilidad
ms.openlocfilehash: ee600cfc22ab1fb7ee43c5727d8e19cf3a1b1463
ms.sourcegitcommit: 2bf79eef6a9b845494484f458443ef4f89d7efc0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/17/2020
ms.locfileid: "97612989"
---
# <a name="openxr-app-best-practices"></a><span data-ttu-id="c8c91-104">Prácticas recomendadas de aplicaciones de OpenXR</span><span class="sxs-lookup"><span data-stu-id="c8c91-104">OpenXR app best practices</span></span>

<span data-ttu-id="c8c91-105">Puede ver un ejemplo de los procedimientos recomendados que se indican a continuación en el archivo OpenXRProgram. cpp de <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>.</span><span class="sxs-lookup"><span data-stu-id="c8c91-105">You can see an example of the best practices below in <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>'s OpenXRProgram.cpp file.</span></span> <span data-ttu-id="c8c91-106">La función Run () al principio captura un flujo de código de la aplicación OpenXR típico desde la inicialización hasta el bucle de representación y evento.</span><span class="sxs-lookup"><span data-stu-id="c8c91-106">The Run() function at the beginning captures a typical OpenXR app code flow from initialization to the event and rendering loop.</span></span>

## <a name="best-practices-for-visual-quality-and-stability"></a><span data-ttu-id="c8c91-107">Prácticas recomendadas para la calidad y estabilidad visual</span><span class="sxs-lookup"><span data-stu-id="c8c91-107">Best practices for visual quality and stability</span></span>

<span data-ttu-id="c8c91-108">En los procedimientos recomendados de esta sección se describe cómo obtener la mejor calidad y estabilidad visual de cualquier aplicación de OpenXR.</span><span class="sxs-lookup"><span data-stu-id="c8c91-108">The best practices in this section describe how to get the best visual quality and stability in any OpenXR application.</span></span>

<span data-ttu-id="c8c91-109">Para obtener más recomendaciones sobre el rendimiento específicas de HoloLens 2, consulte la sección [procedimientos recomendados para el rendimiento en hololens 2](#best-practices-for-performance-on-hololens-2) a continuación.</span><span class="sxs-lookup"><span data-stu-id="c8c91-109">For further performance recommendations specific to HoloLens 2, see the [Best practices for performance on HoloLens 2](#best-practices-for-performance-on-hololens-2) section below.</span></span>

### <a name="gamma-correct-rendering"></a><span data-ttu-id="c8c91-110">Representación gamma-correcta</span><span class="sxs-lookup"><span data-stu-id="c8c91-110">Gamma-correct rendering</span></span>

<span data-ttu-id="c8c91-111">Se debe tener cuidado para asegurarse de que la canalización de representación sea correcta.</span><span class="sxs-lookup"><span data-stu-id="c8c91-111">Care must be taken to ensure that your rendering pipeline is gamma-correct.</span></span> <span data-ttu-id="c8c91-112">Al representar en un intercambio, el formato de vista de destino de representación debe coincidir con el formato de intercambio.</span><span class="sxs-lookup"><span data-stu-id="c8c91-112">When rendering to a swapchain, the render-target view format should match the swapchain format.</span></span> <span data-ttu-id="c8c91-113">Por ejemplo, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` para el formato intercambio y la vista representación-destino.</span><span class="sxs-lookup"><span data-stu-id="c8c91-113">For example, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` for both the swapchain format and the render-target view.</span></span>
<span data-ttu-id="c8c91-114">Existe una excepción si la canalización de representación de la aplicación realiza una conversión sRGB manual en el código del sombreador.</span><span class="sxs-lookup"><span data-stu-id="c8c91-114">There's an exception if the app's rendering pipeline does a manual sRGB conversion in shader code.</span></span> <span data-ttu-id="c8c91-115">La aplicación debe solicitar un formato sRGB intercambio, pero usar el formato lineal para la vista Render-Target.</span><span class="sxs-lookup"><span data-stu-id="c8c91-115">The app should request an sRGB swapchain format but use the linear format for the render-target view.</span></span> <span data-ttu-id="c8c91-116">Por ejemplo, solicite `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` como el formato intercambio, pero use `DXGI_FORMAT_B8G8R8A8_UNORM` como vista de destino de representación para evitar que el contenido se corrija con doble gamma.</span><span class="sxs-lookup"><span data-stu-id="c8c91-116">For example, request `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` as the swapchain format but use `DXGI_FORMAT_B8G8R8A8_UNORM` as the render-target view to prevent content from being double-gamma corrected.</span></span>

### <a name="submit-depth-buffer-for-projection-layers"></a><span data-ttu-id="c8c91-117">Enviar búfer de profundidad para capas de proyección</span><span class="sxs-lookup"><span data-stu-id="c8c91-117">Submit depth buffer for projection layers</span></span>

<span data-ttu-id="c8c91-118">Use siempre `XR_KHR_composition_layer_depth` Extension y envíe el búfer de profundidad junto con la capa de proyección al enviar un fotograma a `xrEndFrame` .</span><span class="sxs-lookup"><span data-stu-id="c8c91-118">Always use `XR_KHR_composition_layer_depth` extension and submit the depth buffer together with the projection layer when submitting a frame to `xrEndFrame`.</span></span>
<span data-ttu-id="c8c91-119">La habilitación de la reproyección de profundidad de hardware en HoloLens 2 mejora la estabilidad del holograma.</span><span class="sxs-lookup"><span data-stu-id="c8c91-119">Enabling hardware depth reprojection on HoloLens 2 improves hologram stability.</span></span>

### <a name="choose-a-reasonable-depth-range"></a><span data-ttu-id="c8c91-120">Elegir un intervalo de profundidad razonable</span><span class="sxs-lookup"><span data-stu-id="c8c91-120">Choose a reasonable depth range</span></span>

<span data-ttu-id="c8c91-121">Prefiera un intervalo de profundidad más estrecho para definir el ámbito del contenido virtual para ayudar a la estabilidad del holograma en HoloLens.</span><span class="sxs-lookup"><span data-stu-id="c8c91-121">Prefer a narrower depth range to scope the virtual content to help hologram stability on HoloLens.</span></span>
<span data-ttu-id="c8c91-122">Por ejemplo, el ejemplo OpenXrProgram. cpp usa 0,1 metros en 20 metros.</span><span class="sxs-lookup"><span data-stu-id="c8c91-122">For example, the OpenXrProgram.cpp sample is using 0.1 meters to 20 meters.</span></span>
<span data-ttu-id="c8c91-123">Use [invertida-Z](https://developer.nvidia.com/content/depth-precision-visualized) para una resolución de profundidad más uniforme.</span><span class="sxs-lookup"><span data-stu-id="c8c91-123">Use [reversed-Z](https://developer.nvidia.com/content/depth-precision-visualized) for a more uniform depth resolution.</span></span>
<span data-ttu-id="c8c91-124">En HoloLens 2, el uso del `DXGI_FORMAT_D16_UNORM` formato de profundidad preferido le ayudará a lograr una mayor velocidad de fotogramas y rendimiento, aunque los búferes de profundidad de 16 bits proporcionan una resolución menos profunda que los búferes de profundidad de 24 bits.</span><span class="sxs-lookup"><span data-stu-id="c8c91-124">On HoloLens 2, using the preferred `DXGI_FORMAT_D16_UNORM` depth format will help achieve better frame rate and performance, although 16-bit depth buffers provide less depth resolution than 24-bit depth buffers.</span></span>
<span data-ttu-id="c8c91-125">Seguir estas prácticas recomendadas para hacer el mejor uso de la resolución de profundidad es más importante.</span><span class="sxs-lookup"><span data-stu-id="c8c91-125">Following these best practices to make best use of the depth resolution becomes more important.</span></span>

### <a name="prepare-for-different-environment-blend-modes"></a><span data-ttu-id="c8c91-126">Preparación para diferentes modos de fusión de entornos</span><span class="sxs-lookup"><span data-stu-id="c8c91-126">Prepare for different environment blend modes</span></span>

<span data-ttu-id="c8c91-127">Si la aplicación también se va a ejecutar en auriculares envolventes que bloqueen completamente el mundo, asegúrese de enumerar los modos de Blend de entorno admitidos con `xrEnumerateEnvironmentBlendModes` la API y preparar el contenido de representación correctamente.</span><span class="sxs-lookup"><span data-stu-id="c8c91-127">If your application will also run on immersive headsets that completely block out the world, be sure to enumerate supported environment blend modes using `xrEnumerateEnvironmentBlendModes` API, and prepare your rendering content correctly.</span></span>
<span data-ttu-id="c8c91-128">Por ejemplo, para un sistema con, `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` como HoloLens, la aplicación debe usar transparente como color sin cifrar, mientras que en el caso de un sistema con `XR_ENVIRONMENT_BLEND_MODE_OPAQUE` , la aplicación debe representar algún color opaco o alguna sala virtual en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="c8c91-128">For example, for a system with `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` such as the HoloLens, the app should use transparent as the clear color, while for a system with `XR_ENVIRONMENT_BLEND_MODE_OPAQUE`, the app should render some opaque color or some virtual room in the background.</span></span>

### <a name="choose-unbounded-reference-space-as-applications-root-space"></a><span data-ttu-id="c8c91-129">Elegir espacio de referencia sin enlazar como espacio de la raíz de la aplicación</span><span class="sxs-lookup"><span data-stu-id="c8c91-129">Choose unbounded reference space as application's root space</span></span>

<span data-ttu-id="c8c91-130">Normalmente, las aplicaciones establecen algún espacio de coordenadas del mundo raíz para conectar las vistas, las acciones y los hologramas juntos.</span><span class="sxs-lookup"><span data-stu-id="c8c91-130">Applications typically establish some root world coordinate space to connect views, actions, and holograms together.</span></span>
<span data-ttu-id="c8c91-131">Use `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` cuando se admita la extensión para establecer un [sistema de coordenadas de escala mundial](../../design/coordinate-systems.md#building-a-world-scale-experience), lo que permite a la aplicación evitar el desplazamiento de hologramas no deseado cuando el usuario se desplaza lejos (por ejemplo, 5 metros de distancia) desde donde se inicia la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c8c91-131">Use `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` when the extension is supported to establish a [world-scale coordinate system](../../design/coordinate-systems.md#building-a-world-scale-experience), enabling your app to avoid undesired hologram drift when the user moves far (for example, 5 meters away) from where the app starts.</span></span>
<span data-ttu-id="c8c91-132">Use `XR_REFERENCE_SPACE_TYPE_LOCAL` como reserva si la extensión de espacio sin enlazar no existe.</span><span class="sxs-lookup"><span data-stu-id="c8c91-132">Use `XR_REFERENCE_SPACE_TYPE_LOCAL` as a fallback if the unbounded space extension doesn't exist.</span></span>

### <a name="associate-hologram-with-spatial-anchor"></a><span data-ttu-id="c8c91-133">Asociar holograma con delimitador espacial</span><span class="sxs-lookup"><span data-stu-id="c8c91-133">Associate hologram with spatial anchor</span></span>

<span data-ttu-id="c8c91-134">Cuando se usa un espacio de referencia sin enlazar, los hologramas colocados directamente en ese espacio de referencia pueden desplazarse [a medida que el usuario dirige a habitaciones lejanas y, a continuación,](../../design/coordinate-systems.md#building-a-world-scale-experience)vuelve.</span><span class="sxs-lookup"><span data-stu-id="c8c91-134">When using an unbounded reference space, holograms you place directly in that reference space [may drift as the user walks to distant rooms and then comes back](../../design/coordinate-systems.md#building-a-world-scale-experience).</span></span>
<span data-ttu-id="c8c91-135">En el caso de los usuarios de hologramas colocan en una ubicación discreta del mundo, [crean un delimitador espacial](../../design/spatial-anchors.md#best-practices) con la `xrCreateSpatialAnchorSpaceMSFT` función de extensión y colocan el holograma en su origen.</span><span class="sxs-lookup"><span data-stu-id="c8c91-135">For hologram users place at a discrete location in the world, [create a spatial anchor](../../design/spatial-anchors.md#best-practices) using the `xrCreateSpatialAnchorSpaceMSFT` extension function and position the hologram at its origin.</span></span> <span data-ttu-id="c8c91-136">De este modo, el holograma será estable de manera independiente con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="c8c91-136">That will keep that hologram independently stable over time.</span></span>

### <a name="support-mixed-reality-capture"></a><span data-ttu-id="c8c91-137">Compatibilidad con la captura de realidad mixta</span><span class="sxs-lookup"><span data-stu-id="c8c91-137">Support mixed reality capture</span></span>

<span data-ttu-id="c8c91-138">Aunque la pantalla principal de HoloLens 2 usa la combinación de entornos aditivos, cuando el usuario inicia una [captura de realidad mixta](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), el contenido de representación de la aplicación se combinará alfa con el flujo de vídeo del entorno.</span><span class="sxs-lookup"><span data-stu-id="c8c91-138">Although HoloLens 2's primary display uses additive environment blending, when the user starts [mixed reality capture](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), the app's rendering content will be alpha-blended with the environment video stream.</span></span>
<span data-ttu-id="c8c91-139">Para lograr la mejor calidad visual en vídeos de captura de realidad mixta, es mejor establecer en la de la `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` capa de proyección `layerFlags` .</span><span class="sxs-lookup"><span data-stu-id="c8c91-139">To achieve the best visual quality in mixed reality capture videos, it's best to set the `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` in your projection layer's `layerFlags`.</span></span>

## <a name="best-practices-for-performance-on-hololens-2"></a><span data-ttu-id="c8c91-140">Prácticas recomendadas para el rendimiento en HoloLens 2</span><span class="sxs-lookup"><span data-stu-id="c8c91-140">Best practices for performance on HoloLens 2</span></span>

<span data-ttu-id="c8c91-141">Como dispositivo móvil con compatibilidad con la reproyección de hardware, HoloLens 2 tiene requisitos más estrictos para un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="c8c91-141">As a mobile device with hardware reprojection support, HoloLens 2 has stricter requirements for optimal performance.</span></span>  <span data-ttu-id="c8c91-142">Hay varias maneras de enviar datos de composición a través de, lo que produce un procesamiento posterior con una penalización de rendimiento notable.</span><span class="sxs-lookup"><span data-stu-id="c8c91-142">There are a number of ways to submit composition data through, which results in post-processing with a noticeable performance penalty.</span></span>

### <a name="select-a-swapchain-format"></a><span data-ttu-id="c8c91-143">Seleccionar un formato de intercambio</span><span class="sxs-lookup"><span data-stu-id="c8c91-143">Select a swapchain format</span></span>

<span data-ttu-id="c8c91-144">Enumere siempre los formatos de píxel admitidos mediante `xrEnumerateSwapchainFormats` y elija el primer formato de píxeles de color y profundidad del tiempo de ejecución que admita la aplicación, ya que es lo que el tiempo de ejecución prefiere para un rendimiento óptimo.</span><span class="sxs-lookup"><span data-stu-id="c8c91-144">Always enumerate supported pixel formats using `xrEnumerateSwapchainFormats`, and choose the first color and depth pixel format from the runtime that the app supports, because that's what the runtime prefers for optimal performance.</span></span> <span data-ttu-id="c8c91-145">Tenga en cuenta que, en HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` y `DXGI_FORMAT_D16_UNORM` suele ser la primera opción para lograr un mejor rendimiento de la representación.</span><span class="sxs-lookup"><span data-stu-id="c8c91-145">Note, on HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` and `DXGI_FORMAT_D16_UNORM` is typically the first choice to achieve better rendering performance.</span></span> <span data-ttu-id="c8c91-146">Esta preferencia puede ser diferente en los auriculares de VR que se ejecutan en un equipo de escritorio, donde los búferes de profundidad de 24 bits tienen menos impacto en el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c8c91-146">This preference can be different on VR headsets running on a Desktop PC, where 24-bit depth buffers have less of a performance impact.</span></span>
  
<span data-ttu-id="c8c91-147">**Advertencia de rendimiento:** El uso de un formato distinto del formato de color intercambio principal dará como resultado un procesamiento posterior en tiempo de ejecución, lo que supone una penalización significativa del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c8c91-147">**Performance Warning:** Using a format other than the primary swapchain color format will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="render-with-recommended-rendering-parameters-and-frame-timing"></a><span data-ttu-id="c8c91-148">Representar con los parámetros de representación recomendados y los intervalos de fotogramas</span><span class="sxs-lookup"><span data-stu-id="c8c91-148">Render with recommended rendering parameters and frame timing</span></span>

<span data-ttu-id="c8c91-149">Siempre se representa con el ancho y alto de la configuración de vista recomendada ( `recommendedImageRectWidth` y `recommendedImageRectHeight` desde `XrViewConfigurationView` ) y use siempre la `xrLocateViews` API para consultar la representación de vista recomendada, el subproceso y otros parámetros de representación antes de la representación.</span><span class="sxs-lookup"><span data-stu-id="c8c91-149">Always render with the recommended view configuration width/height (`recommendedImageRectWidth` and `recommendedImageRectHeight` from `XrViewConfigurationView`), and always use `xrLocateViews` API to query for the recommended view pose, FOV, and other rendering parameters before rendering.</span></span>
<span data-ttu-id="c8c91-150">Use siempre el `XrFrameEndInfo.predictedDisplayTime` de la llamada más reciente `xrWaitFrame` al consultar las vistas y las vistas.</span><span class="sxs-lookup"><span data-stu-id="c8c91-150">Always use the `XrFrameEndInfo.predictedDisplayTime` from the latest `xrWaitFrame` call when querying for poses and views.</span></span>
<span data-ttu-id="c8c91-151">Esto permite a HoloLens ajustar la representación y optimizar la calidad visual de la persona que posee HoloLens.</span><span class="sxs-lookup"><span data-stu-id="c8c91-151">This allows HoloLens to adjust rendering and optimize visual quality for the person who is wearing the HoloLens.</span></span>

### <a name="use-a-single-projection-layer"></a><span data-ttu-id="c8c91-152">Usar una sola capa de proyección</span><span class="sxs-lookup"><span data-stu-id="c8c91-152">Use a single projection layer</span></span>

<span data-ttu-id="c8c91-153">HoloLens 2 tiene una potencia de GPU limitada para la representación de contenido y un compositor de hardware optimizado para una sola capa de proyección.</span><span class="sxs-lookup"><span data-stu-id="c8c91-153">HoloLens 2 has limited GPU power for rendering content and a hardware compositor optimized for a single projection layer.</span></span>
<span data-ttu-id="c8c91-154">El uso de una sola capa de proyección puede ayudar a la velocidad de fotogramas de la aplicación, la estabilidad del holograma y la calidad visual.</span><span class="sxs-lookup"><span data-stu-id="c8c91-154">Always using a single projection layer can help the application's framerate, hologram stability and visual quality.</span></span>  
  
<span data-ttu-id="c8c91-155">**Advertencia de rendimiento:** El envío de cualquier elemento, pero con un nivel de protección único, dará lugar a un procesamiento posterior en tiempo de ejecución, lo que supone una penalización significativa del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c8c91-155">**Performance Warning:** Submitting anything but a single protection layer will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="render-with-texture-array-and-vprt"></a><span data-ttu-id="c8c91-156">Representar con la matriz de textura y VPRT</span><span class="sxs-lookup"><span data-stu-id="c8c91-156">Render with texture array and VPRT</span></span>

<span data-ttu-id="c8c91-157">Cree uno `xrSwapchain` para el ojo izquierdo y derecho con el `arraySize=2` fin de intercambio de color y otro para la profundidad.</span><span class="sxs-lookup"><span data-stu-id="c8c91-157">Create one `xrSwapchain` for both left and right eye using `arraySize=2` for color swapchain, and one for depth.</span></span>
<span data-ttu-id="c8c91-158">Representar el ojo izquierdo en el segmento 0 y el ojo derecho en el segmento 1.</span><span class="sxs-lookup"><span data-stu-id="c8c91-158">Render the left eye into slice 0 and the right eye into slice 1.</span></span>
<span data-ttu-id="c8c91-159">Use un sombreador con VPRT y llamadas de dibujo con instancias para la representación de Stereoscopic a fin de minimizar la carga de la GPU.</span><span class="sxs-lookup"><span data-stu-id="c8c91-159">Use a shader with VPRT and instanced draw calls for stereoscopic rendering to minimize GPU load.</span></span>
<span data-ttu-id="c8c91-160">Esto también permite la optimización del tiempo de ejecución para lograr el mejor rendimiento en HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="c8c91-160">This also enables the runtime's optimization to achieve the best performance on HoloLens 2.</span></span>
<span data-ttu-id="c8c91-161">Las alternativas al uso de una matriz de textura, como la representación de doble ancho o una intercambio independiente por ojo, darán lugar a un procesamiento posterior en tiempo de ejecución, lo que supone una penalización significativa del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c8c91-161">Alternatives to using a texture array, such as double-wide rendering or a separate swapchain per eye, will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="avoid-quad-layers"></a><span data-ttu-id="c8c91-162">Evite las cuatro capas</span><span class="sxs-lookup"><span data-stu-id="c8c91-162">Avoid quad layers</span></span>

<span data-ttu-id="c8c91-163">En lugar de enviar cuatro capas como capas de composición con `XrCompositionLayerQuad` , represente el contenido cuádruple directamente en la proyección intercambio.</span><span class="sxs-lookup"><span data-stu-id="c8c91-163">Rather than submitting quad layers as composition layers with `XrCompositionLayerQuad`, render the quad content directly into the projection swapchain.</span></span>

<span data-ttu-id="c8c91-164">**Advertencia de rendimiento:** Proporcionar capas adicionales más allá de una sola capa de proyección, como las capas cuádruples, dará como resultado un procesamiento posterior en tiempo de ejecución, lo que supone una penalización significativa del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c8c91-164">**Performance Warning:** Providing additional layers beyond a single projection layer, such as quad layers, will result in runtime post-processing, which comes at a significant performance penalty.</span></span>